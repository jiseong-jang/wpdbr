[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/nginx.err.log
stdout_logfile=/var/log/supervisor/nginx.out.log

[program:backend]
command=/usr/lib/jvm/java-17-openjdk-amd64/bin/java -Xmx512m -jar /app/backend/app.jar
directory=/app/backend
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/backend.err.log
stdout_logfile=/var/log/supervisor/backend.out.log
environment=PORT="8080",SPRING_DATASOURCE_URL="%(ENV_SPRING_DATASOURCE_URL)s",SPRING_DATASOURCE_USERNAME="%(ENV_SPRING_DATASOURCE_USERNAME)s",SPRING_DATASOURCE_PASSWORD="%(ENV_SPRING_DATASOURCE_PASSWORD)s",JWT_SECRET="%(ENV_JWT_SECRET)s",FRONTEND_URL="%(ENV_FRONTEND_URL)s",SPRING_PROFILES_ACTIVE="prod"
startsecs=15
stopwaitsecs=10
stopasgroup=true
killasgroup=true

[program:voice-api]
command=/usr/bin/python3 -m uvicorn app.main:app --host 0.0.0.0 --port 5001
directory=/app/voice-order-fastapi
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/voice-api.err.log
stdout_logfile=/var/log/supervisor/voice-api.out.log
environment=VOICE_ORDER_CLIENT_ORIGIN="%(ENV_VOICE_ORDER_CLIENT_ORIGIN)s",VOICE_ORDER_MODEL_PRESET="%(ENV_VOICE_ORDER_MODEL_PRESET)s",OPENAI_API_KEY="%(ENV_OPENAI_API_KEY)s",VOICE_ORDER_CHAT_MODEL="%(ENV_VOICE_ORDER_CHAT_MODEL)s",VOICE_ORDER_HF_ENDPOINT="%(ENV_VOICE_ORDER_HF_ENDPOINT)s",VOICE_ORDER_HF_MODEL="%(ENV_VOICE_ORDER_HF_MODEL)s",VOICE_ORDER_HF_TOKEN="%(ENV_VOICE_ORDER_HF_TOKEN)s"

